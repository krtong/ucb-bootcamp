<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Giffy Gallery</title>
  <style type="text/css">
    button,
    div,
    form,
    input {
      margin: 10px;
    }

    #add-shit-here {
      display: flex;
      flex-wrap: wrap;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>giphy Search</h1>
    <header>
      <div id="buttons-view"></div>
    </header>
    <div class="row">
      <div class="col-5">
        <div class="clean-gallery" id="add-shit-here"></div>
      </div>
      <div class="col-2">
        <form id="giphy-form">
          <label for="giphy-input">Add a giphy, Yo!</label>
          <input type="text" id="giphy-input"><br>
          <input id="add-giphy" type="submit" value="Add a giphy, Yo!">
        </form>
      </div>
    </div>

    <div id="prerender" style="display:none"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      let giphys = ["The Matrix", "The Notebook", "Mr. Nobody", "The Lion King"];
      let numOfGifs = 10;
      let imgObj = {};


      function renderGif(...e) {
        // console.log(e)
        let idx = $(this).attr("id")
        let giphyName = $(this).attr("data-name");
        let type = "animated"
        let classes = "img-fluid"
        $(this).attr("src", imgObj[giphyName][idx].animated);
        $(this).attr("class", classes + " " + type)
      }


      function renderStatic() {
        let idx = $(this).attr("id")
        let giphyName = $(this).attr("data-name");
        let type = "static"
        let classes = "img-fluid"
        $(this).attr("src", imgObj[giphyName][idx].static);
        $(this).attr("class", classes + " " + type)
      }

      function renderImg() {

      }

      function grabgiphyImages(titleStr, dataArr) {
        let arr = []
        dataArr.forEach(obj => {
          let tempObj = {};
          tempObj.static = obj.images['fixed_height_still'].url;
          tempObj.animated = obj.images['fixed_height'].url;
          tempObj.rating = obj.rating;
          arr.push(tempObj)
        });
        imgObj[titleStr] = arr;
      }


      function alertgiphyName() {
        $("#add-shit-here").empty();
        let giphyName = $(this).attr("data-name");
        if (imgObj[giphyName]) {
          populateImages(imgObj[giphyName])
        } else {
          $.ajax({
            url: `https://api.giphy.com/v1/gifs/search?api_key=FMm6h8iCj05LtP1gHs2RaqXNkERa7HxZ&q=${giphyName}&limit=${numOfGifs}&offset=0&rating=G&lang=en`,
            method: "GET"
          }).then(function (response) {
            console.log("response", response)
            grabgiphyImages(giphyName, response.data)
            populateImages(imgObj[giphyName], giphyName);
          });
        }
      };

      function populateImages(dataObj, dataName) {
        $("#add-shit-here").empty();
        dataObj.forEach((imgObj, index) => {

          $("#add-shit-here").append(`
          <div id="div${index}"> 
            <h3>Rating: ${imgObj.rating}</h3>
            <img class="static" id="${index}" data-name="${dataName}"  src="${imgObj['static']}">
          </div>
          `)
          $("#prerender").append(`<img src="${imgObj['animated']}"></div>`)
        })
      };


      // let oneImage =  dataObj.data[i].images['480w_still'].url
      function renderButtons() {
        $("#buttons-view").empty();
        giphys.forEach(giphy => {
          $("#buttons-view").append(`<button class="giphy" data-name="${giphy}">${giphy}</button>`);
        })
      };

      $("#add-giphy").on("click", function (event) {
        event.preventDefault();
        let giphy = $("#giphy-input").val().trim();
        giphys.push(giphy);
        renderButtons();
      });

      $(document).on("click", ".giphy", alertgiphyName);
      $(document).on("click", ".static", renderGif);
      $(document).on("click", ".animated", renderStatic);

      renderButtons();
    </script>
  </div>
</body>

</html>